---
title: Dietary fiber content in common bean from the middle
  american gene pool
author: "skammlade"
date: "17 June 2016"
output:
  pdf_document:
    fig_caption: yes
    includes:
      in_header: preamble_fig_env.tex
    latex_engine: xelatex
    toc: yes
    toc_depth: 2
  html_document:
    toc: yes
  word_document:
    fig_caption: yes
    toc: yes
header-includes:
- \usepackage{booktabs}
- \usepackage{longtable}
- \captionsetup[table]{singlelinecheck=false,justification=raggedright,position=top,skip=50pt}
graphics: yes
sansfont: Calibri Light
fontsize: 12pt
---

\renewcommand{\sfdefault}{phv}

## Introduction

```{r echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
fiber<- read.csv("fiber.csv")
#subset fiber data to remove black mottle, flor de mayo, red mottle, carioca, and tan
fibersub <- subset(fiber, mktclass=='GN' | mktclass=='pink' | mktclass=='pinto' | mktclass=='small red' | mktclass=='black' | mktclass=='small white')
```

`r nrow(fibersub)/2` entries from the BeanCAP study were grown in Fort Collins, CO in 2015. All entries originated from the Middle American gene pool and were further subdivided into two races and six market classes after removing lesser important market classes (Table 1). Beans were analyzed for various fiber components to determine the effect of marketclass and race (Table 2).

| Race | Market Class | No. Entries | 
| ------------ | ----------- | ------------ | 
| Durango | | **`r sum(fibersub$race=="durango", na.rm=TRUE)/2`** |
| | GN | `r sum(fibersub$mktclass=="GN", na.rm=TRUE)/2` |
| | pink | `r sum(fibersub$mktclass=="pink", na.rm=TRUE)/2` |
| | pinto | `r sum(fibersub$mktclass=="pinto", na.rm=TRUE)/2` |
| | small red | `r sum(fibersub$mktclass=="small red", na.rm=TRUE)/2` | 
| Mesoamerican | | **`r sum(fibersub$race=="mesoamerican", na.rm=TRUE)/2`** |
| | black |   `r sum(fibersub$mktclass=="black", na.rm=TRUE)/2` |
| | small white     |  `r sum(fibersub$mktclass=="small white", na.rm=TRUE)/2` |

Table: Number of entries by race and market class included in the study.

Fiber component | Description
--------------------|-------------------------------------------
Soluble | Dissolves in water
Insoluble | Does not dissolve in water
Raffinose | A trisaccharide
Stachyose | A tetrasaccharide
Verbascose | A pentasachharide
Total Oligosaccharides | Sum of verbascose, raffinose, and stachyose
Total Dietary Fiber | Sum of soluble fiber, insoluble fiber, and total oligosaccharides

Table: Fiber components measured in the study. Faffinose, stachyose, and verbascose are grouped together broadly as total oligosaccharides. These carbohydrates are not digested in the small intestine and are instead passed into the large intestine to be fermented by microflora with the production of gas.

## Results: Entry Rankings

Tables below show the five entries with the greatest and five entries with the lowest values of each fiber component averaged across the two replications including standard deviation (sd), standard error (se) and confindence intervals (ci).

## --  Total Dietary Fiber (TDF) 

```{r echo=FALSE, message=FALSE, warning=FALSE}
source('summarySE.R')
source('ranking.R')
library(knitr)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
kable(head.TDF, caption="Five entries with greatest TDF content.")
kable(tail.TDF, caption="Five entries with lowest TDF content.")
```

\pagebreak

## --  Raffinose (Raff)
```{r echo=FALSE, message=FALSE, warning=FALSE}
kable(head.Raff, caption="Five entries with greatest Raff content.")
kable(tail.Raff, caption="Five entries with lowest Raff content.")
```

## --  Stachyose (Stach)
```{r echo=FALSE, message=FALSE, warning=FALSE}
kable(head.Stach, caption="Five entries with greatest Stach content.")
kable(tail.Stach, caption="Five entries with lowest Stach content.")
```

## --  Verbascose (Verb)
```{r echo=FALSE, message=FALSE, warning=FALSE}
kable(head.Verb, caption="Five entries with greatest Verb content.")
kable(tail.Verb, caption="Five entries with lowest Verb content.")
```

## --  Total Oligosachharides (TOligos)
```{r echo=FALSE, message=FALSE, warning=FALSE}
kable(head.TOligos, caption="Five entries with greatest TOligos content.")
kable(tail.TOligos, caption="Five entries with lowest TOligos content.")
```

## -- Insoluble Dietary Fiber (IDF) 
```{r echo=FALSE, message=FALSE, warning=FALSE}
kable(head.IDF, caption="Five entries with greatest IDF content.")
kable(tail.IDF, caption="Five entries with lowest IDF content.")
```

## --  Soluble Dietary Fiber (SDF)
```{r echo=FALSE, message=FALSE, warning=FALSE}
kable(head.SDF, caption="Five entries with greatest SDF content.")
kable(tail.SDF, caption="Five entries with lowest SDF content.")
```

## Results: Marketclass

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(data.table)
fiber.one<- read.csv("fiber_facet.csv")
```

##   --   Boxplots

```{r echo=FALSE, message=FALSE, warning=FALSE}
source('subset.mkt.R')
```

```{r fig.width = 8, fig.height=8, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Oligosaccharide content in common bean by marketclass (A) Raffinose, (B) Stachyose, (C) Verbascose, and (D) total oligosaccharides (= Raff + Stach + Verb). Blue boxes (GN, pink, pinto, small red) belong to race Durango, red boxes (black, small white) belong to race Mesoamerica."}
##Boxplots by Marketclass: Oligosaccharides

source('boxplot.mktclass.R')
plot_grid(p.Raff.mkt, p.Stach.mkt, p.Verb.mkt, p.TOligos.mkt, labels = c("A", "B", "C", "D"), ncol = 2)
```

\pagebreak

| Marketclass | Raffinose | Stachyose | Verbascose | Total Oligosaccharides |
---------|--------|--------|---------|---------|
black | `r round(mean(raff.black$value),3)` a | `r round(mean(stach.black$value),3)` b | `r round(mean(verb.black$value),2)` a | `r round(mean(toligos.black$value),2)` b |
GN | `r round(mean(raff.GN$value),3)` bc | `r round(mean(stach.GN$value),3)` b | `r round(mean(verb.GN$value),2)` c | `r round(mean(toligos.GN$value),2)` b |
pink | `r round(mean(raff.pink$value),3)` a | `r round(mean(stach.pink$value),3)` ab | `r round(mean(verb.pink$value),2)` bc | `r round(mean(toligos.pink$value),2)` ab |
pinto | `r round(mean(raff.pinto$value),3)` a | `r round(mean(stach.pinto$value),3)` b | `r round(mean(verb.pinto$value),2)` c | `r round(mean(toligos.pinto$value),2)` b |
small red | `r round(mean(raff.smallred$value),3)` ab | `r round(mean(stach.smallred$value),3)` b | `r round(mean(verb.smallred$value),2)` c | `r round(mean(toligos.smallred$value),2)` b |
small white | `r round(mean(raff.smallwhite$value),3)` c | `r round(mean(stach.smallwhite$value),3)` a | `r round(mean(verb.smallwhite$value),2)` ab | `r round(mean(toligos.smallwhite$value),2)` a |

Table: Mean fiber component content by market class. Values with different letters differ significantly between market classes (p<0.05). Bolded values are the greatest among market classes.

```{r echo=FALSE, message=FALSE, warning=FALSE}
source('outlier.R')
library(xtable, knitr)
kable(xtable(out.raff.mkt), caption="Raffinose outliers.", digits=3)
kable(xtable(out.stach.mkt), caption="Stachyose outliers.", digits=3)
kable(xtable(out.verb.mkt), caption="Verbascose outliers.", digits=2)
kable(xtable(out.toligos.mkt), caption="Total oligosaccharides outliers.", digits=2)
```

\pagebreak

```{r fig.width = 8, fig.height=5, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, fig.cap="(A) Soluble and (B) insoluble dietary fiber in common bean by marketclass.Blue boxes (GN, pink, pinto, small red) belong to race Durango, red boxes (black, small white) belong to race Mesoamerica."}
##Boxplots by Marketclass: Soluble and Insoluble DF
source('boxplot.mktclass.R')
plot_grid(p.IDF.mkt, p.SDF.mkt, labels = c("A", "B"), ncol = 2)
```

| Marketclass | Insoluble DF | Soluble DF
---------|--------|--------
black | `r round(mean(idf.black$value),2)` c | `r round(mean(sdf.black$value),2)` a 
GN | `r round(mean(idf.GN$value),2)` a | `r round(mean(sdf.GN$value),2)` ab 
pink | `r round(mean(idf.pink$value),2)` abc | `r round(mean(sdf.pink$value),2)` b 
pinto | `r round(mean(idf.pinto$value),2)` b | `r round(mean(sdf.pinto$value),2)` a 
small red | `r round(mean(idf.smallred$value),2)` c | `r round(mean(sdf.smallred$value),2)` ab 
small white | `r round(mean(idf.smallwhite$value),2)` ab | `r round(mean(sdf.smallwhite$value),2)` ab 

Table: Mean fiber component content by market class. Values with different letters differ significantly between market classes (p<0.05). Bolded values are the greatest among market classes.

\pagebreak

```{r echo=FALSE, message=FALSE, warning=FALSE}
source('outlier.R')
library(xtable, knitr)
kable(xtable(out.IDF.mkt), caption="IDF outliers.", digits=2)
kable(xtable(out.SDF.mkt), caption="SDF outliers.", digits=2)
```

\pagebreak

```{r fig.width = 4, fig.height=4.5, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Total Dietary Fiber content in common bean by marketclass.Blue boxes (GN, pink, pinto, small red) belong to race Durango, red boxes (black, small white) belong to race Mesoamerica."}
##Boxplots by Marketclass: Total Dietary Fiber
source('boxplot.mktclass.R')
p.TDF.mkt
```

| Marketclass | Total DF 
---------|--------
black | `r round(mean(tdf.black$value),2)` bc 
GN | `r round(mean(tdf.GN$value),2)` ab
pink | `r round(mean(tdf.pink$value),2)` cd 
pinto | `r round(mean(tdf.pinto$value),2)` ab 
small red | `r round(mean(tdf.smallred$value),2)` d 
small white | `r round(mean(tdf.smallwhite$value),2)` a 

Table: Mean total dietary fiber component content by market class. Values with different letters differ significantly between market classes (p<0.05).

\pagebreak

```{r echo=FALSE, message=FALSE, warning=FALSE}
source('outlier.R')
library(xtable, knitr)
kable(xtable(out.TDF.mkt), caption="Total DF outliers.", digits=2)
```

\pagebreak

##   --  Lineplots

```{r fig.width = 8, fig.height=10, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Mean content of each oligosaccharide along the Raffinose Oligosaccharide Family pathway."}
##Boxplots by Marketclass: Oligosaccharides
source('lineplot.oligo.mkt.R')
p.oli.mkt
```

\pagebreak

## Results: Race

```{r echo=FALSE, message=FALSE, warning=FALSE}
source('subset.race.R')
```

##   --   Boxplots

```{r fig.width = 8, fig.height=6.5, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Oligosaccharide content in common bean by race (A) Raffinose, (B) Stachyose, (C) Verbascose, and (D) total oligosaccharides (= Raff + Stach + Verb)."}
##Boxplots by race: Oligosaccharides
source('boxplot.race.R')
plot_grid(p.Raff.race, p.Stach.race, p.Verb.race, p.TOligos.race, labels = c("A", "B", "C", "D"), ncol = 2, align="w")
```

| Race | Verbascose | Raffinose | Stachyose | Total Oligosaccharides |
---------|--------:|--------:|---------:|---------:|
Durango | `r round(mean(raff.durango$value),3)` a | `r round(mean(stach.durango$value),2)` b | `r round(mean(verb.durango$value),3)` b | `r round(mean(toligos.durango$value),2)` a |
Mesoamerican | `r round(mean(raff.meso$value),3)` b | `r round(mean(stach.meso$value),2)` a | `r round(mean(verb.meso$value),3)` a | `r round(mean(toligos.meso$value),2)` a |

Table: Mean fiber component content by race. Values with different letters differ significantly between races (p<0.05).

```{r echo=FALSE, message=FALSE, warning=FALSE}
source('outlier.R')
library(xtable, knitr)
kable(xtable(out.raff.race), caption="Raffinose outliers.", digits=3)
kable(xtable(out.stach.race), caption="Stachyose outliers.", digits=3)
kable(xtable(out.verb.race), caption="Verbascose outliers.", digits=2)
kable(xtable(out.toligos.race), caption="Total oligosaccharides outliers.", digits=2)
```

\pagebreak

```{r fig.width = 8, fig.height=4, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, fig.cap="(A) Soluble and (B) insoluble dietary fiber in common bean by race,"}
##Boxplots by race: Soluble and Insoluble DF
source('boxplot.race.R')
plot_grid(p.IDF.race, p.SDF.race, labels = c("A", "B"), ncol = 2, align="w")
```

| Race | Insoluble DF | Soluble DF | 
---------|--------:|--------:|
Durango | `r round(mean(idf.durango$value),2)` a | `r round(mean(sdf.durango$value),2)` a | 
Mesoamerican | `r round(mean(idf.meso$value),2)` a | `r round(mean(sdf.meso$value),2)` a |

Table: Mean fiber component content by race. Values with different letters differ significantly between races (p<0.05).

\pagebreak

```{r echo=FALSE, message=FALSE, warning=FALSE}
source('outlier.R')
library(xtable, knitr)
kable(xtable(out.IDF.race), caption="IDF outliers.", digits=2)
kable(xtable(out.SDF.race), caption="SDF outliers.", digits=2)
```

\pagebreak

```{r fig.width = 4, fig.height=4, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Total Dietary Fiber content inn common bean by race"}
##Boxplots by race: Total Dietary Fiber
source('boxplot.race.R')
p.TDF.race
```

| Race | Total DF |
---------|--------:|
Durango | `r round(mean(tdf.durango$value),2)` a | 
Mesoamerican | `r round(mean(tdf.meso$value),2)` a |

Table: Mean total dietary fiber content by race. Values with different letters differ significantly between races (p<0.05).

\pagebreak

```{r echo=FALSE, message=FALSE, warning=FALSE}
source('outlier.R')
library(xtable, knitr)
kable(xtable(out.TDF.mkt), caption="Total DF outliers.", digits=2)
```

\pagebreak

##   --  Lineplots

```{r fig.width = 8, fig.height=10, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Mean content of each oligosaccharide along the Raffinose Oligosaccharide Family pathway."}
source('lineplot.oligo.race.R')
p.oli.race
```

\pagebreak

## Statistical Methods

Statistical analyses, figures, tables, and reporting was completed using RStudio Version 0.98.1062.

## -- *ANOVA*

One-way analysis of variance was conducted to determine the effect of 1) rep, 2) race, and 3) marketclass. Rep was treated as random, race and marketclass were treated as fixed with marketclass nested within race.

```{r echo=FALSE, message=FALSE, warning=FALSE}
source('anova.nest.R')
library(xtable, knitr)

kable(xtable(OneWayFit.Raff), caption="ANOVA table testing raffinose.", digits=4)
kable(xtable(OneWayFit.Stach), caption="ANOVA table testing stachyose.", digits=4)
kable(xtable(OneWayFit.Verb), caption="ANOVA table testing verbascose.", digits=4)
kable(xtable(OneWayFit.TOligos), caption="ANOVA table testing total oligosaccharides.", digits=4)
kable(xtable(OneWayFit.IDF), caption="ANOVA table testing insoluble DF.", digits=4) 
kable(xtable(OneWayFit.SDF), caption="ANOVA table testing soluble DF.", digits=4)
kable(xtable(OneWayFit.TDF), caption="ANOVA table testing total DF.", digits=4)
```


## --  *ANOVA Assumptions*

Insoluble fiber, soluble fiber, raffinose, stachyose, and verbascose data were concluded to meet the assumptions of normality of residuals and equality of variance after plotting qqplots, and residuals versus predicted values. Diagnostic plots are shown below.

```{r fig.width = 8, fig.height=10, echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}
source('plot.test.R')
```

```{r fig.width = 8, fig.height=6, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Residual versus fitted and q-q plots of insoluble and soluble DF. The insoluble DF plots look to reveal non-homogeneity of variance, but both the log and square root transformations did not improve it enough to warrant transforming the data."}
library(cowplot)
plot_grid(p1,p2,p3,p4, ncol=2, labels = c("A", "B", "C", "D"))
```

```{r fig.width = 8, fig.height=9, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Residual versus fitted and q-q plots of verbascose, raffinose, and stachyose. The raffinose plots look to reveal non-homogeneity of variance, but both the log and square root transformations did not improve it enough to warrant transforming the data."}
library(cowplot)
plot_grid(p5,p6,p7,p8,p9,p10, ncol=2, labels = c("A", "B", "C", "D", "E", "F"))
```

## -- *Pairwise Comparisons*

Tukey adjusted pairwise comparisons were made between each market class and each race for each fiber component using the TukeyHSD funcion. These results were used in mean summary tables below boxplots.

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
OneWayFit <- aov(IDF~race, data=fiber)
TukeyHSD(OneWayFit)

library(multcomp)
PairComps <- glht(OneWayFit, linfct=mcp(race="Tukey"))
summary(PairComps)
cld(PairComps)
```

## GxE Analysis

```{r echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
fiber<- read.csv("gxefiber.csv")
#subset fiber data to remove black mottle, flor de mayo, red mottle, carioca, and tan
gxe.fibersub <- subset(fiber, mktclass=='GN' | mktclass=='pink' | mktclass=='pinto' | mktclass=='small red' | mktclass=='black' | mktclass=='small white')
```

`r nrow(gxe.fibersub)/4` of the `r nrow(fibersub)/2` entries grown in Fort Collins, CO in 2015 were also grown in North Dakota. All entries originated from the Middle American gene pool and were further subdivided into two races and six market classes. Beans were assayed for fiber components to determine effects of g, e, and gxe.

| Race | Market Class | No. Entries | 
| ------------ | ----------- | ------------ | 
| Durango | | **`r sum(gxe.fibersub$race=="durango", na.rm=TRUE)/4`** |
| | GN | `r sum(gxe.fibersub$mktclass=="GN", na.rm=TRUE)/4` |
| | pink | `r sum(gxe.fibersub$mktclass=="pink", na.rm=TRUE)/4` |
| | pinto | `r sum(gxe.fibersub$mktclass=="pinto", na.rm=TRUE)/4` |
| | small red | `r sum(gxe.fibersub$mktclass=="small red", na.rm=TRUE)/4` | 
| Mesoamerican | | **`r sum(gxe.fibersub$race=="mesoamerican", na.rm=TRUE)/4`** |
| | black |   `r sum(gxe.fibersub$mktclass=="black", na.rm=TRUE)/4` |
| | small white     |  `r sum(gxe.fibersub$mktclass=="small white", na.rm=TRUE)/4` |

## -- Lineplot

```{r fig.width = 8, fig.height=4, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, fig.cap="(A) Soluble and (B) insoluble dietary fiber in common bean by race,"}
##Boxplots by race: Soluble and Insoluble DF
source('lineplot.gxe.mkt.R')
plot_grid(p.gxe.mkt.IDF, p.gxe.mkt.SDF, labels = c("A", "B"), ncol = 2, align="w")
```


##  -- ANOVA

